# Cosense Taskflow

Cosenseのタスクデータを一覧形式で可視化・編集可能にするWebアプリケーション。

## 概要

Cosense TaskflowはCosenseからJSONデータを読み込み、タスク情報をインタラクティブなインターフェースで表示します。インターフェース上でタスクを直接編集し、変更をCosense形式で再エクスポートすることで、双方向のタスク管理を実現します。

## タスクページ
- 指定のアイコン（デフォルトは`[leaves.icon]`）を含むページをタスクとして認識し一覧表示
  - ただし、除外タグ（デフォルトは`#Exclude`または`[Exclude]`）があるページは除外します


### タスク情報

タスクの情報は、以下のような情報をページ内に記載することで
```
タスクタイトル
[leaves.icon]
[stem.icon][プロジェクト名] [Assigned to 担当者]
[Status_inProgress] [Stage_active]
開始日 [2025-01-01] 期限日 [2025-01-15]
[Context_work] [Importance_high] [Urgency_normal]

タスクの説明がここに入ります...
```

#### ステータス
タスクの現在の進行状況を示します

**デフォルトオプション**
- `Status_notStarted` - 未着手
- `Status_inProgress` - 進行中
- `Status_waiting` - 待機中（外部要因）
- `Status_review` - レビュー中（人間レビュー待ちなど）
- `Status_completed` - 完了（デフォルトで非表示）

#### ステージ
タスクがどのような状態にあるのかを示します

**デフォルトオプション**
- `Stage_active` - アクティブ（inbox）
- `Stage_inactive` - 非アクティブ（デフォルトで非表示）
- `Stage_someday` - いつかやる 💛
- `Stage_temp` - 仮登録状態 🩶

#### 担当者
タスクの担当者を示します

**デフォルトオプション**
- `Assigned to human` - 人間にアサイン
- `Assigned to ai` - AIにアサイン

#### 開始日、期限日
例:`開始日 [2025-01-01] 期限日 [2025-01-15]`  
開始日と期限日を設定可能です
- 開始日前のタスクはデフォルトで非表示

#### 重要度・緊急度
重要度もしくは緊急度が高いものはハイライト表示されます
- `[Importance_high]`: 重要度高
- `[Urgency_high]`: 緊急度高

#### プロジェクト
`[stem.icon][プロジェクト名]`でプロジェクトを指定可能です

#### 親タスク
`from [親タスク]`で親タスクを指定可能です

**Cosense連携**
- CosenseバックアップAPIからのリアルタイムデータ取得
- レート制限を回避するインテリジェントキャッシュシステム
- 新しいバックアップの自動検出
- 設定可能な認証とプロジェクト設定

## 機能

**Cosenseデータの読み込み**
- Cosense記法の自動パースによるタスク情報の抽出
- CosenseバックアップエンドポイントとのリアルタイムAPI連携
- ドラッグ&ドロップまたはファイル選択によるJSONファイルの読み込みにも対応

**リアルタイムタスク編集**
- インターフェースでのステータス、ステージ、担当者の直接編集
  - ステータスは色で表示
- 変更されたタスクの視覚的フィードバック
- 同時編集時の競合検出と解決
- 自動バックアップ＆キャッシュシステム

**エクスポート＆インポート**
- 変更されたタスクのCosense互換JSONエクスポート
- プロジェクト名プレースホルダーをサポートする柔軟なファイル名形式
- エクスポート前の自動データ取得（オプション）
- Cosenseインポートインターフェースとの直接連携

**フィルタリング＆ソート**
- プロジェクト、ステータス、ステージ、担当者でフィルタリング可能
- スマートソート（期限日 → 重要度・緊急度 → ステータス）
  - **レベル1: 期限日順**（期限日なし = 最低優先度）
  - **レベル2: 重要度・緊急度**（#Importance_high, #Urgency_high, [Importance_high], [Urgency_high]）
  - **レベル3: ステータス順**（inProgress → waiting → review → notStarted → completed）
  - **レベル4: フォールバック**（更新日、新しい順）
- 完了済み・非アクティブタスクの表示/非表示
- 「プロジェクトなし」オプションを含むプロジェクト別フィルタリング

**インターフェース**
- 重要度・緊急度の高いタスクのハイライト表示
**3段階レスポンシブデザイン**
- **小画面 (<512px)**: 超コンパクトカード形式
- **中画面 (512px-1024px)**: 開始日・期限日付きカード形式
- **デスクトップ (1025px+)**: 横並びリスト形式


## クイックスタート

### 方法1: ファイルアップロード
1. CosenseプロジェクトのデータをJSONでエクスポート
2. ウェブブラウザで`index.html`を開く
3. ファイルアップロードボタンまたはドラッグ&ドロップでJSONファイルを読み込み
4. タスクが自動的に抽出・表示されます

### 方法2: API連携
1. 設定パネル（歯車アイコン）を開く
2. Cosenseプロジェクト名を設定
3. 必要に応じて認証トークンを追加
4. 「最新データを取得」をクリックしてCosenseから直接タスクを読み込み

### サンプルデータ
付属の`data/sample.json`ファイルを使って動作を確認できます。

## 設定項目

### タスク認識設定
ステータス、ステージ、担当者の検出に使用するタグを設定：
- ステータスタグ: ステータス識別子のカンマ区切りリスト
- ステージタグ: ステージ識別子のカンマ区切りリスト
- 担当者タグ: 担当者識別子のカンマ区切りリスト
- 除外タグ: これらのタグを含むタスクは非表示

### API設定
- **自動取得**: 定期的に新しいデータを自動取得
- **取得間隔**: 新しいデータをチェックする頻度（秒単位）
- **認証**: プライベートプロジェクト用のCosenseクッキートークン

### エクスポート設定
- **ファイル名形式**: エクスポートファイル名のテンプレート（PROJECTプレースホルダーサポート）
- **エクスポート前取得**: 変更をエクスポートする前にデータを更新
- **インポートページを開く**: Cosenseインポートインターフェースを自動的に開く

## 開発

### ローカル開発
1. プロジェクトディレクトリでローカルWebサーバーを起動：
   ```bash
   python -m http.server 3000
   ```
2. Cosense API連携のためにプロキシサーバーも起動：
   ```bash
   cd server
   python proxy.py
   ```

### ファイル構造
```
├── index.html          # メインアプリケーション
├── css/
│   └── styles.css     # アプリケーションスタイル
├── js/
│   ├── main.js        # アプリケーション初期化
│   ├── config.js      # 設定
│   ├── data.js        # データ処理
│   ├── ui.js          # UI描画
│   ├── filters.js     # フィルタリング＆ソート
│   ├── export.js      # エクスポート機能
│   ├── settings.js    # 設定管理
│   ├── merge-manager.js # 競合解決
│   └── Cosense-api.js # Cosense API連携
├── server/
│   ├── proxy.py       # ローカル開発用CORSプロキシ
│   └── app.py         # デプロイ用Flaskサーバー
└── data/
    └── sample.json    # テスト用サンプルデータ
```

## ブラウザ対応

- ES6+サポートのモダンブラウザ
- Chrome、Firefox、Safari、Edge（最新版）
- iOS・Androidのモバイルブラウザ

## ライセンス

MIT License - 詳細はLICENSEファイルをご覧ください
