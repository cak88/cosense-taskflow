# Cosense Taskflow

Scrapboxのタスクデータをインタラクティブなかんばん風インターフェースで可視化・編集するWebアプリケーション。

## 概要

Cosense TaskflowはScrapboxからエクスポートしたJSONデータを読み込み、タスク情報をインタラクティブなかんばん風インターフェースで表示します。インターフェース上でタスクを直接編集し、変更をScrapbox形式で再エクスポートすることで、双方向のタスク管理を実現します。

## 機能

✅ **Scrapboxデータの読み込み**
- ドラッグ&ドロップまたはファイル選択によるJSONファイルの読み込み
- Scrapbox記法の自動パースによるタスク情報の抽出
- ScrapboxバックアップエンドポイントとのリアルタイムAPI連携

**タスク認識**:
- `[leaves.icon]`を含むページをタスクとして認識
- `#Exclude`または`[Exclude]`タグがあるページは除外
- 設定可能なタグ認識設定

✅ **3段階レスポンシブデザイン**
- **小画面 (<512px)**: 超コンパクトカード形式
- **中画面 (512px-1024px)**: 開始日・期限日付きカード形式
- **デスクトップ (1025px+)**: 横並びリスト形式
- 重要度・緊急度の高いタスクのハイライト表示

✅ **高度なフィルタリング＆ソート**
- プロジェクト、ステータス、ステージ、担当者でフィルタリング
- スマートソート（期限日 → 重要度・緊急度 → ステータス）
  - **レベル1: 期限日順**（期限日なし = 最低優先度）
  - **レベル2: 重要度・緊急度**（#Importance_high, #Urgency_high, [Importance_high], [Urgency_high]）
  - **レベル3: ステータス順**（inProgress → waiting → review → notStarted → completed）
  - **レベル4: フォールバック**（更新日、新しい順）
- 完了済み・非アクティブタスクの表示/非表示
- 「プロジェクトなし」オプションを含むプロジェクト別フィルタリング

✅ **リアルタイムタスク編集**
- インターフェースでのステータス、ステージ、担当者の直接編集
- 変更されたタスクの視覚的フィードバック
- 同時編集時の競合検出と解決
- 自動バックアップ＆キャッシュシステム

✅ **Scrapbox連携**
- ScrapboxバックアップAPIからのリアルタイムデータ取得
- レート制限を回避するインテリジェントキャッシュシステム
- 新しいバックアップの自動検出
- 設定可能な認証とプロジェクト設定

✅ **エクスポート＆インポート**
- 変更されたタスクのScrapbox互換JSONエクスポート
- プロジェクト名プレースホルダーをサポートする柔軟なファイル名形式
- エクスポート前の自動データ取得（オプション）
- Scrapboxインポートインターフェースとの直接連携

## はじめに

### 方法1: ファイルアップロード
1. ScrapboxプロジェクトのデータをJSONでエクスポート
2. ウェブブラウザで`index.html`を開く
3. ファイルアップロードボタンまたはドラッグ&ドロップでJSONファイルを読み込み
4. タスクが自動的に抽出・表示されます

### 方法2: API連携
1. 設定パネル（歯車アイコン）を開く
2. Scrapboxプロジェクト名を設定
3. 必要に応じて認証トークンを追加
4. 「最新データを取得」をクリックしてScrapboxから直接タスクを読み込み

### サンプルデータ
付属の`data/sample.json`ファイルを使って動作を確認できます。

## タスク形式

タスクはScrapboxページ内の`[leaves.icon]`の存在によって識別されます。以下の形式が認識されます：

```
タスクタイトル
[leaves.icon] [2025-01-01] ID:[task-001]
[stem.icon][プロジェクト名] [担当者名]
[Status_inProgress] [Stage_active]
開始日 [2025-01-01] 期限日 [2025-01-15]
[Context_work] [Importance_high] [Urgency_normal]

タスクの説明がここに入ります...
```

### ステータスオプション
- `Status_notStarted` - 未着手
- `Status_inProgress` - 進行中
- `Status_waiting` - 待機中（外部依存）
- `Status_review` - レビュー中
- `Status_completed` - 完了

### ステージオプション
- `Stage_active` - アクティブタスク
- `Stage_inactive` - 非アクティブ・保留タスク（デフォルトで非表示）
- `Stage_someday` - いつか・もしかして タスク
- `Stage_temp` - 一時的タスク

## 設定

### タスク認識設定
ステータス、ステージ、担当者の検出に使用するタグを設定：
- ステータスタグ: ステータス識別子のカンマ区切りリスト
- ステージタグ: ステージ識別子のカンマ区切りリスト
- 担当者タグ: 担当者識別子のカンマ区切りリスト
- 除外タグ: これらのタグを含むタスクは非表示

### API設定
- **自動取得**: 定期的に新しいデータを自動取得
- **初回取得**: アプリケーション読み込み時にデータを取得
- **取得間隔**: 新しいデータをチェックする頻度（秒単位）
- **認証**: プライベートプロジェクト用のScrapboxクッキートークン

### エクスポート設定
- **ファイル名形式**: エクスポートファイル名のテンプレート（PROJECTプレースホルダーサポート）
- **エクスポート前取得**: 変更をエクスポートする前にデータを更新
- **インポートページを開く**: Scrapboxインポートインターフェースを自動的に開く

## 開発

### ローカル開発
1. プロジェクトディレクトリでローカルWebサーバーを起動：
   ```bash
   python -m http.server 3000
   ```
2. Scrapbox API連携のためにプロキシサーバーも起動：
   ```bash
   cd server
   python proxy.py
   ```

### ファイル構造
```
├── index.html          # メインアプリケーション
├── css/
│   └── styles.css     # アプリケーションスタイル
├── js/
│   ├── main.js        # アプリケーション初期化
│   ├── config.js      # 設定
│   ├── data.js        # データ処理
│   ├── ui.js          # UI描画
│   ├── filters.js     # フィルタリング＆ソート
│   ├── export.js      # エクスポート機能
│   ├── settings.js    # 設定管理
│   ├── merge-manager.js # 競合解決
│   └── scrapbox-api.js # Scrapbox API連携
├── server/
│   ├── proxy.py       # ローカル開発用CORSプロキシ
│   └── app.py         # デプロイ用Flaskサーバー
└── data/
    └── sample.json    # テスト用サンプルデータ
```

## ブラウザ対応

- ES6+サポートのモダンブラウザ
- Chrome、Firefox、Safari、Edge（最新版）
- iOS・Androidのモバイルブラウザ

## ライセンス

MIT License - 詳細はLICENSEファイルをご覧ください

## 貢献

1. リポジトリをフォーク
2. 機能ブランチを作成
3. 変更を行う
4. 十分にテスト
5. プルリクエストを提出

## サポート

問題が発生した場合や質問がある場合：
1. サンプルデータ形式を確認
2. Scrapboxデータエクスポート形式を確認
3. セットアップの詳細とともにGitHubでissueを開く

---

最大限の互換性とパフォーマンスのためにバニラJavaScriptで構築。